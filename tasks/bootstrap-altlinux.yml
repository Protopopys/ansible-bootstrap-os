---
- name: Bootstrap | Check if bootstrap is needed
  raw: PACKAGE=$(rpm -qa --qf "%{NAME}\n" |grep -e ^{{ item }}$ | tr -d '\n' | tr -d '\r') ; if [ -z "${PACKAGE}" ]; then exit 1 ; fi ;
  register: need_bootstrap
  failed_when: false
  changed_when: false
  with_items: "{{ base_packages }}"

- name: Bootstrap | Install Python
  raw: apt-get update && apt-get install -y {{ base_packages|join(" ") }}
  when: need_bootstrap.results | map(attribute='rc') | sort | last | bool
  with_items: "{{ base_packages }}"
  notify:
    - Bootstrap | Handlers | Setting fact - ansible_python_interpreter

- name: Bootstrap | flush handlers
  meta: flush_handlers

- name: Bootstrap | Install required packages
  apt_rpm:
    name: "{{ item }}"
    state: present
    update_cache: true
  loop: "{{ required_packages }}"
  notify:
    - Bootstrap | Handlers | Gathering facts
