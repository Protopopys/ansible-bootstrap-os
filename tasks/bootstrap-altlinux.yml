---
- name: Bootstrap | Check if bootstrap is needed
  raw: PACKAGE=$(rpm -qa --qf "%{NAME}\n" |grep -e ^{{ item }}$ | tr -d '\n' | tr -d '\r') ; if [ -z "${PACKAGE}" ]; then exit 1 ; fi ;
  register: need_bootstrap
  failed_when: false
  changed_when: false
  with_items: "{{ python[interpreter_version] }}"

- name: Bootstrap | Install Python_{{ interpreter_version }}
  raw: apt-get update && apt-get install -y {{ python[interpreter_version]|join(" ") }}
  when: need_bootstrap.results | map(attribute='rc') | sort | last | bool

- name: Bootstrap | Setting fact - ansible_python_interpreter
  set_fact:
    ansible_python_interpreter: "/usr/bin/python"
  when: interpreter_version == 'v2'

- name: Bootstrap | Setting fact - ansible_python_interpreter
  set_fact:
    ansible_python_interpreter: "/usr/bin/python3"
  when: interpreter_version == 'v3'

- name: Bootstrap | Install required packages
  apt_rpm:
    name: "{{ item }}"
    state: present
    update_cache: true
  loop: "{{ required_packages }}"
